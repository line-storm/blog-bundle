{% extends 'LineStormBlogBundle:Admin:layout.html.twig' %}
{% block page_title %}New Blog Post{% endblock %}
{% block page_desc %}Pew Pew Pew{% endblock %}

{% block content %}
    <style>
        #blog-post-content {
            min-height: 400px;
            width: 100%;
            margin: 10px 0 0 0;
            padding: 0;
        }
        .post-component-row {
            padding: 0 0 10px 0;
            margin: 0 0 10px 0;
            border-bottom: 1px solid #cccccc;
            list-style: none;
        }
        .post-component-row > .component-handle {
            width: 30px;
            float: left;
        }
        .post-component-row > .component-handle > i {
            font-size: 18px;
            color: #aaa;
            cursor: ns-resize;
        }
        .post-component-row > .component-content {
            float: left;
            width: calc(100% - 35px);
        }
        .post-component {
            border: 1px solid #eaeaea;
            background-color: #fefefe;
            min-height: 200px;
        }

        .dragged {
            position: absolute;
            opacity: 0.5;
            z-index: 2000;
        }

        ul.example li.placeholder {
            position: relative;
            /** More li styles **/
        }
        ul.example li.placeholder:before {
            position: absolute;
            /** Define arrowhead **/
        }
    </style>
    {% stylesheets
        '@LineStormBlogBundle/Resources/public/css/dropzone.css'
        filter='cssrewrite' output='compiled/css/blog.css' %}
     <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}

    {% javascripts
        '@LineStormBlogBundle/Resources/public/js/dropzone.js'
        output='compiled/js/blog.js' %}
        <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
    <script type="text/javascript" src="/bundles/linestormblog/js/ckeditor/ckeditor.js"></script>
    <script type="text/javascript" src="/bundles/linestormblog/js/ckeditor/adapters/jquery.js"></script>
    <script type="application/javascript">
        $(document).ready(function () {
            var ComponentSelect = $('#ComponentSelect'),
                PostContent = $('#blog-post-content')
            ;

            //$('#blog-post-content').attr('contenteditable', true).ckeditor();

            ComponentSelect.on('change', function(){
                $.ajax({
                    url: '{{ path('linestorm_blog_admin_module_post_component_api_new') }}',
                    data: {
                        'component': $(this).val()
                    },
                    success: function(o){
                        var $e = $('<li class="post-component-row"><div class="component-handle"><i class="fa-ellipsis-h fa-rotate-90 fa-2x pull-left fa-border"></i></div><div class="component-content">'+o.html+'</div><div class="clearfix"></div></li>');
                        var $c = $e.find('.post-component');
                        $e.appendTo(PostContent);
                        $c.attr('contenteditable', true).ckeditor().focus();
                    }
                });

                this.selectedIndex = 0;
            });

            PostContent.sortable({
                handle: '.component-handle > i'
            });
        });
    </script>
    <h1 id="blog-post-title"></h1>

    <div class="row">
        <div class="col-sm-2">
            Add New Component:
        </div>
        <div class="col-sm-10">
            <select id="ComponentSelect" class="form-control">
                <option>Select Component...</option>
                {% for component in module.components %}
                    <option value="{{ component.id }}">{{ component.name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <ul id="blog-post-content">

    </ul>

    {# { form_start(form) } #}
    {# { form(form) }}
    {{ form_end(form) } #}
{% endblock %}
